angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig",function(a,b,c,d,e,f){f=f||{};var g=0,h="ui-tinymce";return f.baseUrl&&(tinymce.baseURL=f.baseUrl),{require:["ngModel","^?form"],link:function(i,j,k,l){function m(){p||(p=tinymce.get(k.id))}if(d.tinymce){var n,o,p,q=l[0],r=l[1]||null,s=function(b){var c=b.getContent({format:o.format}).trim();c=e.trustAsHtml(c),q.$setViewValue(c),a.$$phase||i.$apply()};k.$set("id",h+"-"+g++),n={},angular.extend(n,i.$eval(k.uiTinymce)),o={setup:function(a){a.on("init",function(){q.$render(),q.$setPristine(),r&&r.$setPristine()}),a.on("ExecCommand",function(){a.save(),s(a)}),a.on("change",function(b){a.save(),s(a)}),a.on("blur",function(){j[0].blur()}),a.on("ObjectResized",function(){a.save(),s(a)}),a.on("remove",function(){j.remove()}),n.setup&&n.setup(a,{updateView:s})},format:"raw",selector:"#"+k.id},angular.extend(o,f,n),c(function(){tinymce.init(o)}),q.$formatters.unshift(function(a){return a?e.trustAsHtml(a):""}),q.$parsers.unshift(function(a){return a?e.getTrustedHtml(a):""}),q.$render=function(){m();var a=q.$viewValue?e.getTrustedHtml(q.$viewValue):"";p&&p.getDoc()&&(p.setContent(a),p.fire("change"))},k.$observe("disabled",function(a){a?(m(),p&&p.getBody().setAttribute("contenteditable",!1)):(m(),p&&p.getBody().setAttribute("contenteditable",!0))}),i.$on("$tinymce:refresh",function(a,c){var d=k.id;if(angular.isUndefined(c)||c===d){var e=j.parent(),f=j.clone();f.removeAttr("id"),f.removeAttr("style"),f.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,d),e.append(b(f)(i))}}),i.$on("$destroy",function(){m(),p&&(p.remove(),p=null)})}}}}]);